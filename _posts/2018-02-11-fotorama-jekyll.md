---
title: "Fotorama в Jekyll"
categories: Blog
tags: jekyll
header:
  teaser: "/assets/images/fotorama-jekyll/teaser.jpg"
  og_image: "/assets/images/fotorama-jekyll/teaser.jpg"
img_01:
  - 001.jpg
img_02:
  - 002.jpg
  - 003.jpg
  - 004.jpg
  - 005.jpg
  - 006.jpg
  - 007.jpg
---

Выкладывать фотографии через Jekyll это боль. Редактура заметки о поездке Новосибирск заняла около 2 часов. За это время я бы мог написать ещё две таких. Собственно по этой же причине я пока не перенёс посты из старого блога и поддерживаю его работоспособность. Ситуация будет постепенно меняться и начало уже положено.

Самая напрягающая часть это отсутствие вменяемой дефолтной галереи. В Jekyll из коробки её вообще нет, все картинки это просто html теги проецируемые из markdown и никакого фронтенда над ними. В шаблоне, который используется у меня в данный момент есть встроенная [Magnific Popup](http://dimsemenov.com/plugins/magnific-popup/), но это кошмар на который больно смотреть.

В Эгее используется библиотека [Fotorama](http://fotorama.io/) и мне всегда нравилась там работать с картинками, так как автору движка не плевать. Он сам фотографирует, путешествует, понимает всю важность удобного и изящного инструмента. Сначала я поискал на гитхабе популярные jquery решения для организации галерей, но фотораме по прежнему мне кажется самой крутой. Очень жаль, что проект закрыт с 2015 года. Впрочем, работать это ему не мешает, поэтому почему бы не прикрутить его к Jekyll.

Сказано — сделано. Подключается фоторама простым добавлением css и js библиотеки к шаблону сайта. А вот дальше сложней, ведь надо ещё оборачивать все необходимые картинки в div с нужным набором классов. Jekyll не очень приспособлен под работу с динамикой, но благодаря [Liquid](https://shopify.github.io/liquid/) кое-какие механизмы всё же есть.

Для начала определим переменные для хранения всех картинок сайта и запишем их в отдельный файл `assets.yml` внутри папки `_data`. Это Можно сделать и в основном конфиге сайта, но рекомендуется использовать именно `_data` для хранения персональных переменных:

{% highlight yaml %}
images: "/assets/images/"
files: "/assets/files/"
{% endhighlight %}

Теперь добавляем в каталог `_includes` файл с названием `fotorama` со следующим содержимым:

{% highlight html %}
{% raw %}
{% assign images = page[include.id] %}
{% assign assets = site.data.assets.images %}
{% assign slug = page.slug %}
<div class="fotorama" data-nav="thumbs" data-allowfullscreen="true">
  {% for items in images %}
    <img src="{{ site.url }}{{ assets }}{{ slug }}/{{ items }}" data-thumb="{{ site.url }}{{ assets }}{{ slug }}/{{ items }}" width="144" height="96">
  {% endfor %}
</div>
{% endraw %}
{% endhighlight %}

Как видите, Liquid очень похож на какой-нибудь веб фреймворк и работать с ним вполне удобно. Пути для ссылок строятся с использованием переменных, а значит в любой момент их можно переопределить, поменяв, скажем, иерархическое расположение самих файлов или использовать CDN хранилище. Заметки при этом трогать не придётся. Самое главное для нас, что теперь можно работать с изображениями внутри markdown заметок как с отдельной фичей и сейчас я покажу как.

Создадим какую-нибудь заметку и включим в [Front Matter](https://jekyllrb.com/docs/frontmatter/) массив с двумя изображениями:

{% highlight yaml %}
---
title: "Fotorama в Jekyll"
gallery:
  - image1.jpg
  - image2.jpg
---
{% endhighlight %}

Для использования достаточно вызвать Liquid код, импортирующий созданный нами модуль:

{% highlight html %}
{% raw %}
{% include fotorama id="gallery" %}
{% endraw %}
{% endhighlight %}

Значение `id` это есть ни что иное как ссылка на массив картинок из Front Matter с одноимённым названием. Они попадают в цикл модуля fotorama и формируют список картинок в обёртке специфичных классов фоторамы. То есть в чистом html всё что мы сделали в итоге будет выглядеть примерно вот так:

{% highlight html %}
<div class="fotorama" data-nav="thumbs" data-allowfullscreen="true">
    <img src="https://snupt.github.io/assets/images/test/image1.jpg" data-thumb="https://snupt.github.io/assets/images/test/image1.jpg" width="144" height="96">
    <img src="https://snupt.github.io/assets/images/test/image2.jpg" data-thumb="https://snupt.github.io/assets/images/test/image2.jpg" width="144" height="96">
</div>
{% endhighlight %}

Значение `id` может быть любым, именуйте как хотите, а фотографий в массеве любое количество.

Настройки фоторамы определяются также внутри модуля. Картинки для thumb по желанию можно использовать другие, уменьшенных версий, но это уже вопрос автоматизации процесса формирования самих фотографий о котором я, возможно, расскажу в другой раз. По большому счёту можно сделать скрипт, который будет брать импортируемые из фоторедактора файлы, переименовывать их, класть в нужную папку, конвертировать превью и формировать текстовый список в виде yaml массива. Проще простого.

Фотки можно выкладывать как по одной (обратите внимание на возможность открыть её в полном размере):

{% include fotorama id="img_01" %}{: .full}

Так и в группе:

{% include fotorama id="img_02" %}{: .full}

Фоторама работает прекрасно как на декстопе, так и на современных мобильных устройствах.

Дополнительного удобства можно достичь используя сниппеты. Если вы, как и я, любите VS Code, то ниже делюсь готовым.

Для заполнения Front Matter нужен yaml сниппет:

{% highlight yaml %}
"Gallery": {
  "prefix": "img",
  "body": [
    "img_0${1:1}:",
    "  - $2"
  ],
  "description": "Create img gallery"
}
{% endhighlight %}

А этот сработает в markdown части заметки:

{% highlight yaml %}
{% raw %}
"Fotorama": {
  "prefix": "fr",
  "body": [
    "{% include fotorama id=\"img_0$1\" %}{: .full}"
  ],
  "description": "Add fotorama images"
}
{% endraw %}
{% endhighlight %}
